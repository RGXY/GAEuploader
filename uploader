#!/usr/bin/env python

import subprocess
import os
import sys
import os.path
import webbrowser

#The code below is based on the official reference for Google Cloud.
#https://cloud.google.com/sdk/gcloud/reference/

os.chdir(os.path.dirname(sys.argv[0]))
#Sets the environmental variable to python 2.7, the version accepted by Google Cloud SDK.
os.environ["CLOUDSDK_PYTHON"] = "python2.7";
#install alpha and beta, components needed to create the project.
subprocess.check_call(["./google-cloud-sdk/bin/gcloud", "-q", "components", "install", "alpha", "beta"])
subprocess.check_call(["./google-cloud-sdk/bin/gcloud", "auth", "login"])
appname = input("Enter your project name here: ")
webbrowser.open("https://cloud.google.com/console")
#create a project with given PROJECT_ID
subprocess.check_call(["./google-cloud-sdk/bin/gcloud", "alpha", "projects", "create", appname])
#set the project property in the core section
subprocess.check_call(["./google-cloud-sdk/bin/gcloud", "beta", "config", "set", "project", appname])
#set the zone property in the compute section
subprocess.check_call(["./google-cloud-sdk/bin/gcloud", "beta", "config", "set", "compute/zone", "zone3"])
#create an App Engine app within the current Google Cloud Project.
subprocess.check_call(["./google-cloud-sdk/bin/gcloud", "beta", "app", "create", "--region=us-central", "--project=" + appname])
#deploy the meek source code onto the newly created google app engine.
subprocess.check_call(["./google-cloud-sdk/bin/gcloud", "app", "deploy", "./appengine/app.yaml"])
print("Your bridge line is: " + "meek 0.0.2.0:1 url=https://" + appname + ".appspot.com/ front=www.google.com")